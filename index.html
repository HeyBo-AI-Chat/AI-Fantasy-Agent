<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Fantasy Agent</title>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0B132B" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <style>
:root{--bg:#0B132B;--fg:#fff;--muted:#94a3b8;--card:#111827;--accent:#22c55e}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Arial;background:var(--bg);color:var(--fg)}
.wrap{max-width:480px;margin:0 auto;padding:16px}
.card{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:12px;margin-bottom:12px}
.row{display:flex;gap:8px;align-items:center}
.row.spread{justify-content:space-between}
input,select,textarea,button{width:100%}
input,select,textarea{background:#0f172a;color:#fff;border:1px solid #1f2937;border-radius:10px;padding:10px}
textarea{min-height:100px}
.btn{background:var(--accent);color:#000;border:none;border-radius:10px;padding:12px;font-weight:600}
.btn.muted{background:#1f2937;color:#cbd5e1}
.hidden{display:none!important}
/* Bottom tabs */
#tabs{position:sticky;bottom:0;left:0;right:0;background:rgba(11,19,43,.9);backdrop-filter:saturate(120%) blur(6px);
  border-top:1px solid #1f2937;padding:8px;display:flex;gap:8px;max-width:480px;margin:0 auto}
.tabbtn{flex:1;padding:12px 10px;border-radius:10px;background:#111827;color:#cbd5e1;border:1px solid #1f2937}
.tabbtn.active{background:var(--accent);color:#000;font-weight:700}
.badge{font-size:12px;color:#94a3b8}
a.card{display:block;color:inherit;text-decoration:none}
@media (max-width:480px){.row{flex-wrap:wrap}}
</style>
</head>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabs = Array.from(document.querySelectorAll('.tabbtn'));
  const sections = {
    draft:  document.getElementById('tab-draft'),
    roster: document.getElementById('tab-roster'),
    lineup: document.getElementById('tab-lineup'),
    scores: document.getElementById('tab-scores'),
    news:   document.getElementById('tab-news'),
    agent:  document.getElementById('tab-agent'),
  };

  function showTab(name){
    Object.entries(sections).forEach(([k,el]) => el && el.classList.toggle('hidden', k !== name));
    tabs.forEach(b => b.classList.toggle('active', b.dataset.t === name));
    localStorage.setItem('active_tab', name);
  }
  tabs.forEach(b => b.addEventListener('click', () => showTab(b.dataset.t)));
  showTab(localStorage.getItem('active_tab') || 'draft');

  // remove any leftover demo line like “Stefon Diggs”
  const demo = Array.from(document.querySelectorAll('*'))
    .find(n => n.childNodes && [...n.childNodes].some(c => c.nodeType===3 && /Stefon Diggs/i.test(c.textContent||'')));
  if (demo) demo.remove();
});
</script>
  <body>

<main class="wrap">
  <h2>AI Fantasy Agent</h2>

  <!-- Season / Week -->
<div class="stack">
  <select id="season"></select>
  <select id="week"></select>
</div>

<!-- Compute -->
<button id="btnCompute" type="button" data-action="compute" class="btn btn-primary" style="width:100%">
  Compute
</button>

<!-- Sources (this belongs BELOW Compute) -->
<div class="stack" style="margin-top:1rem">
  <label class="label">Select Platform</label>
  <select id="srcPlatform"></select>

  <input id="srcHandle" placeholder="Username / League ID" />

  <textarea id="srcNotes" placeholder="Notes (optional)"></textarea>

  <button id="btnAddSource" type="button" data-action="add-source" class="btn" style="width:100%">
    Add Source
  </button>
</div>

  <!-- LIST OF SAVED SOURCES -->
  <div class="card">
    <h3>Linked Sources</h3>
    <div id="sourcesList">
      <!-- Sources will be dynamically added here -->
    </div>
    <button id="btnReloadSources" class="btn muted">Reload</button>
  </div>

  <!-- ========= TAB PANELS ========= -->

  <!-- DRAFT -->
  <section id="tab-draft">
    <div class="row spread">
      <h3>Draft</h3>
      <span id="draftCount" class="badge">0 players</span>
    </div>
    <div id="draftList" class="card">
      <!-- Draft list will be dynamically added here -->
    </div>
  </section>

  <!-- ROSTER -->
  <section id="tab-roster" class="hidden">
    <div class="row spread">
      <h3>Roster</h3>
      <span id="rosterCount" class="badge">0 players</span>
    </div>
    <div id="rosterList" class="card">
        <!-- Roster list will be dynamically added here -->
    </div>
  </section>

  <!-- LINEUP -->
  <section id="tab-lineup" class="hidden">
    <div class="row spread">
      <h3>Lineup</h3>
      <button id="btnSaveLineup" class="btn">Save Lineup</button>
    </div>
    <div class="card">
      <h4>Starters</h4>
      <div id="starters">
        <!-- Starters will be dynamically added here -->
      </div>
    </div>
    <div class="card">
      <h4>Bench</h4>
      <div id="bench">
        <!-- Bench players will be dynamically added here -->
      </div>
    </div>
  </section>

  <!-- SCORES -->
  <section id="tab-scores" class="hidden">
    <div class="row spread">
      <h3>Scores</h3>
      <span id="scoresUpdated" class="badge">—</span>
    </div>
    <div class="card">
      <div class="row spread">
        <b>Team total</b>
        <b id="teamTotal">0.0</b>
      </div>
    </div>
    <div id="scoresList">
      <!-- Scores will be dynamically added here -->
    </div>
  </section>

  <!-- NEWS -->
  <section id="tab-news" class="hidden">
    <div class="row spread">
      <h3>News & Injuries</h3>
      <button id="btnRefreshNews" class="btn muted">Refresh</button>
    </div>
    <div id="newsList" class="card">
      <!-- News items will be dynamically added here -->
    </div>
  </section>

  <!-- AGENT -->
  <section id="tab-agent" class="hidden">
    <div class="row spread">
      <h3>Agent</h3>
      <div class="row">
        <button id="btnTTS" class="btn muted" title="Toggle speech output">🔈 Speak: Off</button>
        <button id="btnMic" class="btn" title="Hold to talk">🎤 Hold</button>
      </div>
    </div>
    <textarea id="agentInput" class="input" placeholder="Ask Agent… e.g. Start/Sit for Week 3"></textarea>
    <div class="card">
      <div id="voiceStatus" class="badge">Mic idle</div>
    </div>
    <div id="agentReply" class="card">
      <!-- Agent's reply will appear here -->
    </div>
  </section>

</main>

<!-- BOTTOM NAVIGATION -->
<nav id="tabs">
  <button type="button" class="tabbtn active" data-t="draft">Draft</button>
  <button type="button" class="tabbtn" data-t="roster">Roster</button>
  <button type="button" class="tabbtn" data-t="lineup">Lineup</button>
  <button type="button" class="tabbtn" data-t="scores">Scores</button>
  <button type="button" class="tabbtn" data-t="news">News</button>
  <button type="button" class="tabbtn" data-t="agent">Agent</button>
</nav>

<!-- SCRIPTS -->
<script src="./config.js" defer></script>
<script src="./app.js" defer></script>
<script>
  // Initialize Service Worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker
        .register('/sw.js', { scope: '/' })
        .then(r => console.log('Service Worker registered with scope:', r.scope))
        .catch(err => console.warn('Service Worker registration failed:', err));
    });
  }

<!-- 1) Your per‑env config -->
<script src="/config.js"></script>

<!-- 2) Supabase library (CDN or your bundled version) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<!-- 3) Your app -->
<script src="/app.js"></script>
</body>
</html>
