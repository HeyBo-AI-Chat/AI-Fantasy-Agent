<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Fantasy Agent</title>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0B132B" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <style>
:root{--bg:#0B132B;--fg:#fff;--muted:#94a3b8;--card:#111827;--accent:#22c55e}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Arial;background:var(--bg);color:var(--fg)}
.wrap{max-width:480px;margin:0 auto;padding:16px}
.card{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:12px;margin-bottom:12px}
.row{display:flex;gap:8px;align-items:center}
.row.spread{justify-content:space-between}
input,select,textarea,button{width:100%}
input,select,textarea{background:#0f172a;color:#fff;border:1px solid #1f2937;border-radius:10px;padding:10px}
textarea{min-height:100px}
.btn{background:var(--accent);color:#000;border:none;border-radius:10px;padding:12px;font-weight:600}
.btn.muted{background:#1f2937;color:#cbd5e1}
.hidden{display:none!important}
/* Bottom tabs */
#tabs{position:sticky;bottom:0;left:0;right:0;background:rgba(11,19,43,.9);backdrop-filter:saturate(120%) blur(6px);
  border-top:1px solid #1f2937;padding:8px;display:flex;gap:8px;max-width:480px;margin:0 auto}
.tabbtn{flex:1;padding:12px 10px;border-radius:10px;background:#111827;color:#cbd5e1;border:1px solid #1f2937}
.tabbtn.active{background:var(--accent);color:#000;font-weight:700}
.badge{font-size:12px;color:#94a3b8}
a.card{display:block;color:inherit;text-decoration:none}
@media (max-width:480px){.row{flex-wrap:wrap}}
</style>
</head>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabs = Array.from(document.querySelectorAll('.tabbtn'));
  const sections = {
    draft:  document.getElementById('tab-draft'),
    roster: document.getElementById('tab-roster'),
    lineup: document.getElementById('tab-lineup'),
    scores: document.getElementById('tab-scores'),
    news:   document.getElementById('tab-news'),
    agent:  document.getElementById('tab-agent'),
  };

  function showTab(name){
    Object.entries(sections).forEach(([k,el]) => el && el.classList.toggle('hidden', k !== name));
    tabs.forEach(b => b.classList.toggle('active', b.dataset.t === name));
    localStorage.setItem('active_tab', name);
  }
  tabs.forEach(b => b.addEventListener('click', () => showTab(b.dataset.t)));
  showTab(localStorage.getItem('active_tab') || 'draft');

  // remove any leftover demo line like “Stefon Diggs”
  const demo = Array.from(document.querySelectorAll('*'))
    .find(n => n.childNodes && [...n.childNodes].some(c => c.nodeType===3 && /Stefon Diggs/i.test(c.textContent||'')));
  if (demo) demo.remove();
});
</script>
  <body>
  <header>AI Fantasy Agent</header>
  <main>
    <!-- Season / Week -->
    <section class="section">
      <div class="row">
        <select id="season" aria-label="Season"></select>
        <select id="week" aria-label="Week"></select>
      </div>
      <div style="margin-top:12px">
        <button id="btnCompute" type="button" data-action="compute">Compute</button>
      </div>
    </section>

    <!-- Sources -->
    <section class="section">
      <h2>Select Platform</h2>
      <select id="srcPlatform"></select>
      <input id="srcHandle" placeholder="Username / League ID" style="margin-top:8px" />
      <textarea id="srcNotes" placeholder="Notes (optional)" rows="3" style="margin-top:8px"></textarea>
      <div style="margin-top:12px">
        <button id="btnAddSource" type="button" data-action="add-source">Add Source</button>
      </div>

      <div class="card" style="margin-top:16px">
        <div class="row spread">
          <h2 style="margin:0">Linked Sources</h2>
          <button class="muted" id="reloadSources" type="button" onclick="loadSources()">Reload</button>
        </div>
        <div id="linkedSources" style="margin-top:10px"><i>None yet.</i></div>
      </div>
    </section>

    <!-- Draft -->
    <section id="tab-draft" class="section">
      <div class="row spread">
        <h2 style="margin:0">Draft</h2>
        <span class="badge"><span id="draftCount">0</span> players</span>
      </div>
      <div id="draftList"></div>
    </section>

    <!-- Roster -->
    <section id="tab-roster" class="section hidden">
      <div class="row spread">
        <h2 style="margin:0">Roster</h2>
        <span class="badge"><span id="rosterCount">0</span> players</span>
      </div>
      <div id="rosterList"><i>No roster yet.</i></div>
    </section>

    <!-- Lineup -->
    <section id="tab-lineup" class="section hidden">
      <h2>Lineup</h2>
      <div class="card"><b>Starters</b><div id="starters" style="margin-top:6px"></div></div>
      <div class="card"><b>Bench</b><div id="bench" style="margin-top:6px"></div></div>
    </section>

    <!-- Scores -->
    <section id="tab-scores" class="section hidden">
      <h2>Scores</h2>
      <div id="scoresList"></div>
    </section>

    <!-- News -->
    <section id="tab-news" class="section hidden">
      <h2>News</h2>
      <div id="newsList"></div>
    </section>

    <!-- Agent -->
    <section id="tab-agent" class="section hidden">
      <h2>Agent</h2>
      <textarea id="agentInput" placeholder="Ask the agent…" rows="3"></textarea>
      <div class="row" style="margin-top:10px">
        <button id="btnAsk" type="button">Ask</button>
        <button id="btnTTS" type="button" class="muted">🔈 Speak: Off</button>
      </div>
      <div id="agentReply" class="card" style="margin-top:12px"><i>Ask something to get started.</i></div>
    </section>
  </main>

  <!-- Bottom nav -->
  <nav id="tabs">
    <button type="button" class="tabbtn active" data-t="draft">Draft</button>
    <button type="button" class="tabbtn" data-t="roster">Roster</button>
    <button type="button" class="tabbtn" data-t="lineup">Lineup</button>
    <button type="button" class="tabbtn" data-t="scores">Scores</button>
    <button type="button" class="tabbtn" data-t="news">News</button>
    <button type="button" class="tabbtn" data-t="agent">Agent</button>
  </nav>

  <!-- scripts: order matters -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
  <script src="./config.js"></script>
  <script src="./app.js"></script>
</body>
